# 캐시 전략
캐싱 전략은 웹 서비스 환경에서 시스템 성능 향상을 기대할 수 있는 중요한 기술이다.<br>
일반적으로 캐시는 메모리(RAM)을 사용하기 때문에 훨씬 빠르게 데이터를 응답할 수 있지만, 용량 부족 문제가 발생할 수 있다.<br>
따라서, 어느 종류의 데이터를 캐시에 저장할지, 얼만큼 저장할지, 어떤 데이터를 캐시에서 제거할지에 대한 지침 전략을 숙지할 필요가 있다.

- cache hit: 캐시 저장소에 데이터가 있을 경우 바로 가져옴
- cache miss: 캐시 저장소에 데이터가 없을 경우 DB에서 가져옴
<br><br>

## 캐싱 전략 패턴 종류
캐시를 이용하게 되면 반드시 마주치는 <b>데이터 정합성</b> 문제!<br>
데이터 정합성이란, 어떤 데이터가 캐시와 데이터베이스 이 두 곳에서 같은 데이터임에도 불구하고 값이 서로 다른 현상을 말한다.<br>
예를 들면 데이터 수정이 일어났는데, 캐시에만 반영되고 데이터베이스에는 반영되지 않아 정보 불일치가 발생하는 문제를 말한다.<br>
따라서, 적절한 캐시 읽기 전략과 캐시 쓰기 전략을 통해 캐시와 DB간의 데이터 불일치 문제를 극복해야 한다.
<br><br>

### 캐시 읽기 전략 (Read Cache Strategy)
- Look Aside 패턴
  - Cache Aside 패턴이라고도 한다.
  - 데이터를 찾을 때 우선 캐시에 저장된 데이터가 있는지 우선적으로 확인하는 전략.<br>
    만일 캐시에 데이터가 없으면 DB에서 조회한다.
  - 반복적인 읽기가 많은 호출에 적합하다.
  - 캐시와 DB가 분리되어 가용되기 때문에 원하는 데이터만 별도로 구성하여 캐시에 저장할 수 있다.
  - 캐시와 DB가 분리되어 가용되기 때문에 캐시 장애 대비 구성이 되어있다.<br>
    만일 redis가 다운되더라도 DB에서 데이터를 가져올 수 있다.
  - 데이터 정합성 유지 문제가 발생할 수 있다.
  - 초기 조회 시 무조건 DB에서 조회해야 하므로 Cache Warming 작업을 통해 캐시에 미리 데이터를 넣어주기도 한다.
- Read Through 패턴
  - 캐시에서만 데이터를 읽어오는 전략.
  - 데이터 동기화를 라이브러리 또는 캐시 제공자에게 위임하는 방식이라 데이터 동기화가 항상 이루어져 데이터 정합성 문제가 없다.
  - 데이터를 조회하는데 있어 전체적으로 속도가 느리다.
  - 데이터 조회를 전적으로 캐시에만 의지하므로, SPOF 문제가 있을 수 있다. (-> Replication or Cluster 구성으로 해결)
<br><br>

### 캐시 쓰기 전략 (Write Cache Strategy)
- Write Back 패턴
  - Write Behind 패턴이라고도 한다.
  - 데이터를 저장할 때 DB에 바로 쿼리하지 않고, 캐시에 모아두었다가 일정 주기 배치 작업을 통해 DB에 반영한다.
  - 쓰기 쿼리 횟수 비용과 부하를 줄일 수 있다.
  - Write가 빈번하면서 Read를 하는데 많은 양의 리소스가 소모되는 서비스에 적합하다.
  - 캐시에 오류가 발생하면 데이터를 영수 소실할 수 있다.
  - 자주 사용되지 않는 데이터가 저장돼 리소스 낭비가 생길 수 있다 (-> TTL로 해결)
- Write Through 패턴
  - 데이터를 저장할 때 먼저 캐시에 저장한 다음 바로 DB에 저장한다.
  - 데이터 유실이 발생하면 안 되는 상황에 적합하다.
  - 매 요청마다 두 번의 Write가 발생하게 되어 빈번한 생성, 수정이 발생하는 서비스의 경우 성능 이슈가 발생할 수 있다.
  - 자주 사용되지 않는 데이터가 저장돼 리소스 낭비가 생길 수 있다 (-> TTL로 해결)
- Write Around 패턴
  - Write Through보다 훨씬 빠르다.
  - 모든 데이터는 DB에 저장한다. (캐시를 갱신하지 않는다.)
  - Cache miss가 발생하는 경우에만 DB와 캐시에도 데이터를 저장한다.
  - 캐시와 DB 내의 데이터가 다를 수 있다. (데이터 불일치)
<br><br>

### 캐시 읽기 + 쓰기 전략 조합
- Look Aside + Write Around 조합
  - 가장 일반적으로 자주 쓰이는 조합
- Read Through + Write Around 조합
  - 항상 DB에 쓰고, 캐시에서 읽을 때 항상 DB에서 먼저 읽어오므로 데이터 정합성 이슈에 대한 완벽한 안전 장치를 구성할 수 있다. (?)
- Read Through + Write Through 조합
  - 데이터를 쓸 때 항상 캐시에 먼저 쓰므로, 읽어올 때 최신 캐시 데이터를 보장한다.
  - 데이터를 쓸 때 항상 DB에 보내므로 데이터 정합성을 보장한다.